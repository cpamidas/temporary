<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Раздел 3 | Работа с базами данных</title>
    <meta name="description" content="Раздел 3. Работа с файлами | Третий раздел обучающей книги 'PHP для чайников">
</head>
<body>
    <hr id="gotop">
    <h3>Навигация по книге и разделу</h3>
    <hr>
    <a href="/index.html">Главная страница</a><br/>
    <a href="/sections/index.html">Оглавление</a><br/>
    <a href="/sections/section3.html">Раздел 3. Работа с файлами.</a><br/>
    <a href="#filecat">Управление файлами и каталогами</a><br/>
    <a href="#datafile">Работа с данными в файлах</a><br/>
    <a href="#drivefiles">Пример управления файлами</a>
    <hr>
    
    <h1>Раздел 3. Работа с базами данных</h1>
    
    <p>Объём информации в Интернет постоянно растёт, усложняются алгоритмы обработки, анализа и отображения. Для оптимизации хранения и обработки данных созданы специальные программы - системы управления базами данных (СУБД). Они обеспечивают такие функции как одновременный доступ сотен и тысяч пользователей к массиву данных, проверку хранимых данных на корректность и целостность, разрешение или запрещение операций с данными в зависимости от прав пользователей. Кроме того, СУБД обеспечивают унификацию доступа к данным, т.е. любой разработчик или вебмастер, зная тип СУБД, сможет получить и обработать необходимые данные.</p>
    <p>Сейчас уже можно с уверенностью сказать, что ни один более-менее серъёзный сайт не обходится без использования баз данных. Большие форумы, гостевые книги, каталоги, чаты и многое другое создаётся с использованием СУБД.</p>
    <p>Наиболее популярны в настоящее время такие системы как MySQL, Microsoft SQL Server, Oracle, PostgreeSQL и SQLite. Любая СУБД имеет свои преимущества и недостатки. Вопрос "какая СУБД лучше?" - вечное яблоко раздора и предмет "священных войн" программистов и администраторов, особенно начинающих. Специалисты с опытом знают, что идеальной СУБД не существует и в каждом случае надо выбирать наиболее оптимальную систему.</p>
    <p>Так уж исторически сложилось, что в среде PHP-разработчиков наиболее популярен MySQL. Основная причина этого - удобство разработки, бесплатность и изначальная ориентированность на применение в Интернет. Кроме того, некоторые разработчики интерпретатора PHP одновременно являются и разработчиками MySQL.</p>
    <p>В PHP работать с базами данных очень легко. В общем виде процесс работы с базой данных состоит из следующих шагов:</p>
    <p>1. Подключение к серверу и выбор базы данных.<br/>
    2. Выполнение запроса на получение или изменение данных.<br/>
    3. Обработка результатов и освобождение ресурсов.<br/>
    4. Закрытие подключения.</p>
    <p>Для каждого шага в PHP предусмотрен ряд специализированных функций, которые мы рассмотрим в соответствующих уроках данного раздела.</p>
    <p>Более опытным программистам PHP предоставляет специализированные функции для работы с метаданными, т.е. со структурой баз данных, свойствами таблиц и полей и т.п. На начальном этапн лучше воздержаться от использования этих инструментов, создавая базы данных в специализированных редакторах вроде phpMyAdmin или SqlYog.</p>
    
    <h2 id="filecat">Управление файлами и каталогами</h2>
    
    <p>Под управлением файлами и каталогами в PHP подразумеваются такие операции как:</p>
    <p>Создание/удаление<br/>
    Копирование/перемещение<br/>
    Переименование<br/>
    Изменение аттрибутов<br/>
    Чтение содержимого каталога</p>
    
    <p>Копирование файлов производится с помощью функции copy(). Функция имеет всего 2 параметра - имя исходного файла и имя конечного файла. Функция возвращает TRUE, если копирование прошло успешно, и FALSE если произошла ошибка. Если конечный файл уже существует - он будет перезаписан и функция вернёт TRUE. При использовании copy() на Windows-платформе есть особенность: если скопировать файл нулевого размера, то файл успешно скопируется, но copy() вернёт FALSE.</p>
    <p>Пример копирования файла:</p>
    
    <pre><?php

    $source = 'readme.txt';
    $dest = 'readme_copy.txt';

    if(!copy($source, $dest)) {
        echo "Ошибка копирования файла $source...<br />\n";
    }
    ?></pre>
    
    <p>Обратите внимание на конструкцию в конце строки с ошибкой. Этот простой приём позволяет получать читаемый вид выводимого текста независимо от того куда текст выводится - в консоль отладчика или в браузер. Очень удобно на этапе отладки скрипта.</p>
    <p>Более сложный процесс - перемещение файла. Для выполнения перемещения служит функция rename(). Как и предыдущая функция, rename() принимает всего 2 агрумента - старое и новое имя файла. Если пути старого и нового файлов одинаковые - файл просто переименуется, а если разные - будет перемещен но повому пути и переименован.</p>
    <p>Для удаления каталогов служит другая функция - rmdir(). Она принимает единственный параметр - имя каталога, который нужно удалить. Удаляемый каталог должен быть пуст, иначе операция завершится с ошибкой. Если каталог успешно удалён - функция вернёт TRUE, в противном случае - FALSE.</p>    
    
    <h2 id="datafile">Работа с данными в файлах</h2>
    
    <p>Для работы с данными внутри файла есть достаточно много функций. Мы рассмотрим только самые удобные и нужные в практической работе. Полный список вы сможете найти в официальной документации по PHP.</p>
    <p>Для считывания содержимого файла в массив служит функция file(). Файл считывается построчно и каждая строка помещается в отдельный элемент массива. Функция принимает 2 параметра - имя файла и флаг. Флаг определяет режим чтения строк из файла. Например, при чтении можно игнорировать пустые строки и удалять символ перевода строки.</p>
    <p>Например, прочитать и вывести в браузер все строки из файла можно следующим способом:</p>
    
    <pre><?php
    $lines = file('myconfig.txt');
    foreach($lines as $single_line)
        echo $single_line . "<br />\n";
    ?></pre>
    
    <p>Если нужно просто читать и писать блоки текста, то проще всего воспользоваться парой функций file_get_contents() и file_put_contents(). Первая функция считывает и возвращает данные из файла в виде строки, а вторая - записывает блок текста в указанный файл. Пользоваться этими функциями очень просто:</p>
    
    <pre><?php
    $content = file_get_contents('myfile.txt');
    $content = str_replace('{user_name}', 'Иван Петрович', $content);
    file_put_contents('myfile.txt', $content);
    ?></pre>
    
    <p>В этом примере мы считываем всё содержимое файла myfile.txt, заменяем все вхождения строки "{user_name}" на нормальное имя и отчество ("Иван Петрович"), после чего сохраняем изменённые данные обратно в файл. Пользоваться этими функциями очень удобно, когда надо считать всё содержимое файла (например, фрагмент страницы или шаблон письма электронной почты).</p>

    <p>Следующие четыре функции позволяют осуществить так называемый "случайный" доступ к файлу. Термин "случайный" в данном случае означает, что в каком месте файла нам надо работать, в том мы и работаем, передвигаясь по файлу как хотим без всяких ограничений.</p>
    
    <h2 id="drivefiles">Пример управления файлами</h2>

    <p>В практике веб-программиста периодически возникают задачи копирования и простой синхронизации каталогов сервера. В этом примере мы создадим довольно универсальную функцию копирования данных.</p>
    <p>Сохраните текст примера в файле syncfolder.php в одном из каталогов веб-сервера, а так же создайте рядом со скриптом два каталога: src и dest. В первый каталог поместите несколько произвольных файлов и в браузере запустите скрипт на выполнение.</p>
    <p>По окончании копирования в браузере отобразится список скопированных файлов и сообщение "Копирование завершено!", а содержимое каталогов src и dest будет одинаковым.</p>
    <p>Эту функцию можно использовать везде, где надо синхронизировать два каталога или просто скопировать файлы. В коде после пометки "дополнительная обработка" можно вставить любые необходимые операции, например, наложение водяного знака на изображение, регистрация файла в базе данных или удаление.</p>
    <p>При небольшой доработке функцию можно адаптировать для копирования каталога со всеми подкаталогами. Но следует помнить, что на большинстве серверов включен безопасный режим, а значит автоматически создать необходимые каталоги скорее всего не удастся и скрипт завешится с ошибкой.</p>
    <p>Поэтому при разработке скриптов и сайтов надо стараться избегать решений, требующих частого создания или удаления каталогов на сервере. Это упростит процесс поддержки скрипта а также избавит вас от необходимости постоянно подключаться к серверу и вручную создавать нужные каталоги.</p>

    <hr>
    <a href="/sections/index.html">Перейти к оглавлению</a>
    <br />
    <a href="#gotop">Вернуться к началу страницы</a>
    <hr> 
    
</body>
</html>